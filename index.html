<!DOCTYPE html>
<html>

<head>
  <style>
    p {
      font-family: verdana;
      font-size: 400px;
      color: #FFFFFF;
    }
  </style>
  <title>Compass</title>


  <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.js"></script>

  <script type="text/javascript">

    var pubnubDemo = new PubNub({
      publishKey: 'pub-c-7ab40221-08ea-4c9e-a5ed-8de98c8d5253',
      subscribeKey: 'sub-c-40c01cfe-6c46-11e9-81d5-56c3556875f9'
    });

    pubnubDemo.addListener({
      message: function (message) {
        console.log(message.message)
        console.log(message.channel)
      }
    })

    pubnubDemo.subscribe({
      channels: ['north', 'south', 'west', ]
    });


  </script>
  <script>

    // Get event data
    function deviceOrientationListener(event) {
      var alpha = event.alpha; //z axis rotation [0,360)
      var beta = event.beta; //x axis rotation [-180, 180]
      var gamma = event.gamma; //y axis rotation [-90, 90]
      //Check if absolute values have been sent
      if (typeof event.webkitCompassHeading !== "undefined") {
        alpha = event.webkitCompassHeading; //iOS non-standard
        var heading = alpha
        document.getElementById("heading").innerHTML = heading.toFixed([0]);
      }
      else {
        alert("Your device is reporting relative alpha values, so this compass won't point north :(");
        var heading = 360 - alpha; //heading [0, 360)
        document.getElementById("heading").innerHTML = heading.toFixed([0]);
      }


      // Change backgroud colour based on heading
      // Green for North and South, black otherwise
      if (heading > 315 || heading < 45) { //Allow +- 1 degree
        document.body.style.backgroundColor = "green";
        document.getElementById("heading").innerHTML = "N"; // North
      }
      else if (heading > 225 && heading < 314) { //Allow +- 1 degree
        document.body.style.backgroundColor = "red";
        document.getElementById("heading").innerHTML = "E"; // East
      }
      else if (heading > 45 && heading < 135) { //Allow +- 1 degree
        document.body.style.backgroundColor = "blue";
        document.getElementById("heading").innerHTML = "W"; // WEST
      }

      else if (heading > 135 && heading < 225) { //Allow +- 1 degree
        document.body.style.backgroundColor = "pink";
        document.getElementById("heading").innerHTML = "S"; // South
      }
      else { // Otherwise, use near black
        document.body.style.backgroundColor = "#161616";
        //pubnubDemo.unsubscribeAll();
      }
    }

    // Check if device can provide absolute orientation data
    if (window.DeviceOrientationAbsoluteEvent) {
      window.addEventListener("DeviceOrientationAbsoluteEvent", deviceOrientationListener);
    } // If not, check if the device sends any orientation data
    else if (window.DeviceOrientationEvent) {
      window.addEventListener("deviceorientation", deviceOrientationListener);
    } // Send an alert if the device isn't compatible
    else {
      alert("Sorry, try again on a compatible mobile device!");
    }
  </script>
</head>

<body>
  <div id="chat-direction"></div>
      <div class="message">
        <input type="text" id="textfield" placeholder="Write your message">
        </input>
        <input type="submit" value="Send" onclick="publishMessage()"></input>
      </div>
    <p id="heading" style="text-align:center"></p>
</body>

</html>